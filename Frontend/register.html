<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC Hub - Register</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1"></script>
    <style>
        :root { font-family: 'Inter', sans-serif; }
        .bg-gradient-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .input-focus:focus {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .password-strength {
            height: 4px;
            border-radius: 2px;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-primary flex items-center justify-center p-4">
    
    <!-- Animated Background Elements -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-white opacity-10 rounded-full animate-pulse"></div>
        <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-white opacity-5 rounded-full animate-pulse delay-1000"></div>
    </div>

    <!-- Register Container -->
    <div class="relative w-full max-w-lg">
        <!-- Logo and Title -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-white rounded-full shadow-lg mb-4">
                <i class="ph-gear-six-fill text-3xl text-indigo-600"></i>
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">PC Hub</h1>
            <p class="text-indigo-100">Professional Computer Repair Management</p>
        </div>

        <!-- Register Form -->
        <div class="glass-effect rounded-2xl shadow-2xl p-8">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Create Account</h2>
                <p class="text-gray-600 mt-1">Join our repair management system</p>
            </div>

            <form id="registerForm" class="space-y-5">
                <!-- Full Name Input -->
                <div class="space-y-2">
                    <label for="fullName" class="block text-sm font-medium text-gray-700">
                        <i class="ph-user-fill mr-1"></i> Full Name
                    </label>
                    <input 
                        type="text" 
                        id="fullName" 
                        name="fullName" 
                        required 
                        placeholder="John Doe"
                        class="input-focus w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 bg-white/80"
                    >
                </div>

                <!-- Email Input -->
                <div class="space-y-2">
                    <label for="email" class="block text-sm font-medium text-gray-700">
                        <i class="ph-envelope-fill mr-1"></i> Email Address
                    </label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        required 
                        placeholder="john@example.com"
                        class="input-focus w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 bg-white/80"
                    >
                    <div id="emailError" class="text-xs text-red-500 hidden">Please enter a valid email address</div>
                </div>

                <!-- Phone Input -->
                <div class="space-y-2">
                    <label for="phone" class="block text-sm font-medium text-gray-700">
                        <i class="ph-phone-fill mr-1"></i> Phone Number
                    </label>
                    <input 
                        type="tel" 
                        id="phone" 
                        name="phone" 
                        required 
                        placeholder="+91 98765 43210 or 9876543210"
                        class="input-focus w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 bg-white/80"
                    >
                    <div id="phoneError" class="text-xs text-red-500 hidden">Please enter a valid Indian mobile number (10 digits starting with 6-9)</div>
                    <div class="text-xs text-gray-500">Format: +91 98765 43210 or 9876543210</div>
                </div>

                <!-- Password Input -->
                <div class="space-y-2">
                    <label for="password" class="block text-sm font-medium text-gray-700">
                        <i class="ph-lock-fill mr-1"></i> Password
                    </label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            required 
                            placeholder="Create a strong password"
                            class="input-focus w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 bg-white/80"
                        >
                        <button 
                            type="button" 
                            id="togglePassword" 
                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors"
                        >
                            <i class="ph-eye-fill text-lg"></i>
                        </button>
                    </div>
                    <!-- Password Strength Indicator -->
                    <div class="space-y-1">
                        <div id="passwordStrength" class="password-strength bg-gray-200 w-full"></div>
                        <div class="text-xs text-gray-500">
                            <span id="passwordRequirements">Password must be at least 8 characters long</span>
                        </div>
                    </div>
                </div>

                <!-- Confirm Password Input -->
                <div class="space-y-2">
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700">
                        <i class="ph-lock-fill mr-1"></i> Confirm Password
                    </label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            name="confirmPassword" 
                            required 
                            placeholder="Confirm your password"
                            class="input-focus w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-300 bg-white/80"
                        >
                        <button 
                            type="button" 
                            id="toggleConfirmPassword" 
                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors"
                        >
                            <i class="ph-eye-fill text-lg"></i>
                        </button>
                    </div>
                    <div id="passwordMatchError" class="text-xs text-red-500 hidden">Passwords do not match</div>
                </div>

                <!-- Register Button -->
                <button 
                    type="submit" 
                    id="registerBtn"
                    class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-[1.02] hover:shadow-xl flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <i class="ph-user-plus-fill mr-2"></i>
                    Create Account
                </button>

                <!-- Error Message -->
                <div id="errorMessage" class="hidden p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg text-sm">
                    <i class="ph-warning-circle-fill mr-1"></i>
                    <span id="errorText"></span>
                </div>

                <!-- Success Message -->
                <div id="successMessage" class="hidden p-3 bg-green-100 border border-green-300 text-green-700 rounded-lg text-sm">
                    <i class="ph-check-circle-fill mr-1"></i>
                    Account created successfully! Redirecting to login...
                </div>
            </form>

            <!-- Divider -->
            <div class="mt-6 flex items-center">
                <div class="flex-1 border-t border-gray-300"></div>
                <span class="px-4 text-sm text-gray-500">or</span>
                <div class="flex-1 border-t border-gray-300"></div>
            </div>

            <!-- Login Link -->
            <div class="mt-6 text-center">
                <p class="text-gray-600">
                    Already have an account? 
                    <a href="login.html" class="text-indigo-600 hover:text-indigo-800 font-medium transition-colors">
                        Sign in here
                    </a>
                </p>
            </div>
        </div>
    </div>
<script>
    // --- API Configuration ---
    // Make sure this matches your Go backend's location
    const API_BASE_URL = 'http://localhost:8080/api/v1'; 
    const REGISTER_ENDPOINT = `${API_BASE_URL}/auth/register`;
    // -------------------------

    // Form elements
    const form = document.getElementById('registerForm');
    const fullNameInput = document.getElementById('fullName');
    const emailInput = document.getElementById('email');
    const phoneInput = document.getElementById('phone');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    // const termsCheckbox = document.getElementById('terms'); // NOTE: Checkbox not found in HTML
    const registerBtn = document.getElementById('registerBtn');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    const errorText = document.getElementById('errorText');
    
    // --- Validation and UI Toggle Logic (Unchanged) ---
    // (togglePassword, toggleConfirmPassword, validateEmail, validatePhone, 
    // calculatePasswordStrength, updatePasswordStrength, validatePasswordMatch, 
    // real-time validation listeners, showError, resetButton)
    // All these helper functions and listeners remain as you wrote them.
    // ----------------------------------------------------


    // Toggle password visibility
    document.getElementById('togglePassword').addEventListener('click', function() {
        const icon = this.querySelector('i');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.className = 'ph-eye-slash-fill text-lg';
        } else {
            passwordInput.type = 'password';
            icon.className = 'ph-eye-fill text-lg';
        }
    });

    // Toggle confirm password visibility
    document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
        const icon = this.querySelector('i');
        
        if (confirmPasswordInput.type === 'password') {
            confirmPasswordInput.type = 'text';
            icon.className = 'ph-eye-slash-fill text-lg';
        } else {
            confirmPasswordInput.type = 'password';
            icon.className = 'ph-eye-fill text-lg';
        }
    });

    // Validation functions
    function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    function validatePhone(phone) {
        // Remove all non-digit characters except +
        const cleanPhone = phone.replace(/[\s\-\(\)\.]/g, '');
        
        // Indian phone number patterns
        const indianPhonePatterns = [
            /^(\+91|91)?[6-9]\d{9}$/, // Indian mobile: +91XXXXXXXXXX, 91XXXXXXXXXX, XXXXXXXXXX
            /^(\+91|91)?\s?[6-9]\d{4}\s?\d{5}$/, // With spaces: +91 XXXXX XXXXX
            /^(\+91|91)?\-?[6-9]\d{4}\-?\d{5}$/, // With dashes: +91-XXXXX-XXXXX
        ];
        
        // Check if phone matches Indian mobile number patterns
        // We allow cleanPhone.length to be 10 (plain number), 12 (+91XXXXXXXXXX without spaces) or 13 (+91 XXXXX XXXXX with space)
        return indianPhonePatterns.some(pattern => pattern.test(cleanPhone)) && 
               (cleanPhone.length === 10 || cleanPhone.length === 12 || cleanPhone.length === 13);
    }

    function calculatePasswordStrength(password) {
        let strength = 0;
        const requirements = {
            length: password.length >= 8,
            lowercase: /[a-z]/.test(password),
            uppercase: /[A-Z]/.test(password),
            numbers: /\d/.test(password),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
        };

        // Calculate strength based on requirements met
        Object.values(requirements).forEach(met => {
            if (met) strength += 20;
        });

        return { strength, requirements };
    }

    function updatePasswordStrength(password) {
        const { strength, requirements } = calculatePasswordStrength(password);
        const strengthBar = document.getElementById('passwordStrength');
        const requirementsText = document.getElementById('passwordRequirements');

        // Update strength bar
        strengthBar.style.width = strength + '%';
        
        if (strength < 40) {
            strengthBar.className = 'password-strength bg-red-400';
        } else if (strength < 80) {
            strengthBar.className = 'password-strength bg-yellow-400';
        } else {
            strengthBar.className = 'password-strength bg-green-400';
        }

        // Update requirements text
        const unmetRequirements = [];
        if (!requirements.length) unmetRequirements.push('8+ characters');
        if (!requirements.lowercase) unmetRequirements.push('lowercase letter');
        if (!requirements.uppercase) unmetRequirements.push('uppercase letter');
        if (!requirements.numbers) unmetRequirements.push('number');
        if (!requirements.special) unmetRequirements.push('special character');

        if (unmetRequirements.length === 0) {
            requirementsText.textContent = 'Strong password!';
            requirementsText.className = 'text-xs text-green-600';
        } else {
            requirementsText.textContent = `Missing: ${unmetRequirements.join(', ')}`;
            requirementsText.className = 'text-xs text-gray-500';
        }
    }

    // Real-time validation
    emailInput.addEventListener('input', function() {
        const emailError = document.getElementById('emailError');
        const isValid = validateEmail(this.value);
        
        if (this.value.length > 0) {
            if (isValid) {
                this.classList.remove('border-red-300');
                this.classList.add('border-green-300');
                emailError.classList.add('hidden');
            } else {
                this.classList.remove('border-green-300');
                this.classList.add('border-red-300');
                emailError.classList.remove('hidden');
            }
        } else {
            this.classList.remove('border-red-300', 'border-green-300');
            emailError.classList.add('hidden');
        }
    });

    phoneInput.addEventListener('input', function() {
        const phoneError = document.getElementById('phoneError');
        let value = this.value;
        
        // Auto-format Indian mobile numbers as user types
        let cleaned = value.replace(/[^\d+]/g, '');
        
        // Handle +91 prefix
        if (cleaned.startsWith('+91')) {
            cleaned = cleaned.substring(3);
            if (cleaned.length <= 10) {
                if (cleaned.length >= 5) {
                    value = `+91 ${cleaned.slice(0, 5)} ${cleaned.slice(5)}`;
                } else if (cleaned.length > 0) {
                    value = `+91 ${cleaned}`;
                } else {
                    value = '+91 ';
                }
            }
        } else if (cleaned.startsWith('91') && cleaned.length > 2) {
            // Handle 91 prefix without +
            cleaned = cleaned.substring(2);
            if (cleaned.length <= 10) {
                if (cleaned.length >= 5) {
                    value = `+91 ${cleaned.slice(0, 5)} ${cleaned.slice(5)}`;
                } else if (cleaned.length > 0) {
                    value = `+91 ${cleaned}`;
                }
            }
        } else {
            // Handle direct 10-digit number
            if (cleaned.length <= 10) {
                if (cleaned.length >= 5) {
                    value = `${cleaned.slice(0, 5)} ${cleaned.slice(5)}`;
                } else {
                    value = cleaned;
                }
            }
        }
        
        this.value = value;
        
        const isValid = validatePhone(this.value);
        
        if (this.value.length > 0) {
            if (isValid) {
                this.classList.remove('border-red-300');
                this.classList.add('border-green-300');
                phoneError.classList.add('hidden');
            } else {
                this.classList.remove('border-green-300');
                this.classList.add('border-red-300');
                phoneError.classList.remove('hidden');
            }
        } else {
            this.classList.remove('border-red-300', 'border-green-300');
            phoneError.classList.add('hidden');
        }
    });

    passwordInput.addEventListener('input', function() {
        const password = this.value;
        
        if (password.length > 0) {
            updatePasswordStrength(password);
            
            // Check if password meets minimum requirements
            const { strength } = calculatePasswordStrength(password);
            if (strength >= 40) {
                this.classList.remove('border-red-300');
                this.classList.add('border-green-300');
            } else {
                this.classList.remove('border-green-300');
                this.classList.add('border-red-300');
            }
        } else {
            this.classList.remove('border-red-300', 'border-green-300');
            document.getElementById('passwordStrength').style.width = '0%';
            document.getElementById('passwordRequirements').textContent = 'Password must be at least 8 characters long';
        }

        // Revalidate confirm password if it has a value
        if (confirmPasswordInput.value.length > 0) {
            validatePasswordMatch();
        }
    });

    function validatePasswordMatch() {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        const matchError = document.getElementById('passwordMatchError');
        
        if (confirmPassword.length > 0) {
            if (password === confirmPassword) {
                confirmPasswordInput.classList.remove('border-red-300');
                confirmPasswordInput.classList.add('border-green-300');
                matchError.classList.add('hidden');
                return true;
            } else {
                confirmPasswordInput.classList.remove('border-green-300');
                confirmPasswordInput.classList.add('border-red-300');
                matchError.classList.remove('hidden');
                return false;
            }
        } else {
            confirmPasswordInput.classList.remove('border-red-300', 'border-green-300');
            matchError.classList.add('hidden');
            return false;
        }
    }

    confirmPasswordInput.addEventListener('input', validatePasswordMatch);

    // Form validation
    function validateForm() {
        const fullName = fullNameInput.value.trim();
        const email = emailInput.value.trim();
        const phone = phoneInput.value.trim();
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        // const terms = termsCheckbox.checked; // Disabled since checkbox is missing in HTML

        const isEmailValid = validateEmail(email);
        const isPhoneValid = validatePhone(phone);
        const { strength } = calculatePasswordStrength(password);
        const isPasswordStrong = strength >= 40;
        const doPasswordsMatch = password === confirmPassword;

        // Validation check (terms check removed)
        const isValid = fullName && isEmailValid && isPhoneValid && 
                       isPasswordStrong && doPasswordsMatch; // && terms;

        registerBtn.disabled = !isValid;
        return isValid;
    }

    // Add event listeners for form validation
    [fullNameInput, emailInput, phoneInput, passwordInput, confirmPasswordInput].forEach(input => { // termsCheckbox removed
        input.addEventListener('input', validateForm);
        input.addEventListener('change', validateForm);
    });

    // Handle form submission (UPDATED LOGIC)
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const fullName = fullNameInput.value.trim();
        const email = emailInput.value.trim();
        const phone = phoneInput.value.trim();
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        // const terms = termsCheckbox.checked; // Disabled

        // Hide previous messages
        errorMessage.classList.add('hidden');
        successMessage.classList.add('hidden');

        // Final client-side validation check (without terms)
        if (!validateForm()) {
            showError('Please check all fields and create a strong password.');
            return;
        }

        // Show loading state
        registerBtn.innerHTML = '<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div> Creating account...';
        registerBtn.disabled = true;

        const userData = {
            full_name: fullName, // Matches Go struct tag
            email: email,       // Matches Go struct tag
            phone: phone,       // Matches Go struct tag
            password: password  // Matches Go struct tag
        };

        try {
            const response = await fetch(REGISTER_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            });

            const data = await response.json();

            if (response.ok) { // HTTP Status 201 Created
                // Show success message
                successMessage.classList.remove('hidden');
                console.log("Registration Success:", data);
                
                // Set flag for login page
                localStorage.setItem('justRegistered', 'true');
                
                // Redirect to login after delay
                setTimeout(() => {
                    window.location.href = 'login.html?registered=true';
                }, 2000);

            } else {
                // Handle API errors (400, 409, 500)
                let errorMsg = data.message || "An unknown error occurred during registration.";
                
                if (response.status === 409) { // Conflict: Email already registered
                    errorMsg = "An account with this email already exists. Try signing in.";
                } else if (response.status === 400) { // Bad Request: Missing fields/Invalid payload
                    errorMsg = "Invalid input: " + errorMsg;
                } else if (response.status === 500) {
                    errorMsg = "Server error. Please try again later.";
                }

                showError(errorMsg);
                resetButton();
            }

        } catch (error) {
            // Handle network failure (e.g., Go backend not running, CORS blocking)
            console.error('Network Error:', error);
            showError('Could not connect to the server. Is the Go backend running?');
            resetButton();
        }
    });

    function showError(message) {
        errorText.textContent = message;
        errorMessage.classList.remove('hidden');
    }

    function resetButton() {
        registerBtn.innerHTML = '<i class="ph-user-plus-fill mr-2"></i> Create Account';
        registerBtn.disabled = false;
    }

    // Initial form validation
    validateForm();
</script>
</body>
</html>